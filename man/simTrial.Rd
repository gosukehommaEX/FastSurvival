% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simTrial.R
\name{simTrial}
\alias{simTrial}
\title{Simulate clinical trial data for multiple groups with optional subgroups using data.table}
\usage{
simTrial(
  nsim = 1000,
  N,
  a.time,
  intensity = NULL,
  proportion = NULL,
  e.time,
  e.hazard,
  d.time = NULL,
  d.hazard = NULL,
  overall.time = NULL,
  overall.intensity = NULL,
  seed = NULL
)
}
\arguments{
\item{nsim}{A positive integer specifying the number of simulation iterations. Default is 1000.}

\item{N}{A list where each element corresponds to a group, and if subgroups exist,
each element is a named vector with subgroup sample sizes. If no subgroups,
a vector of sample sizes for each group.}

\item{a.time}{A numeric vector of time points defining the accrual intervals for common accrual,
OR a named list where each element corresponds to a subgroup with time points defining
the accrual intervals. Time points must be in increasing order.}

\item{intensity}{A numeric vector of accrual intensities (rate per time unit) for each interval
when using common accrual. Cannot be used with proportion or when a.time is a list. Default is NULL.}

\item{proportion}{A numeric vector of accrual proportions for each interval that sum to 1
when using common accrual. Cannot be used with intensity or when a.time is a list. Default is NULL.}

\item{e.time}{A list where each element corresponds to a group (and subgroup if applicable),
containing time points defining the survival time intervals. Last element must be Inf.}

\item{e.hazard}{A list where each element corresponds to a group (and subgroup if applicable),
containing hazard rates for survival time. All values must be positive.}

\item{d.time}{A list where each element corresponds to a group (and subgroup if applicable),
containing time points defining the dropout time intervals. Last element must be Inf.
Can be NULL if no dropout is assumed. Default is NULL.}

\item{d.hazard}{A list where each element corresponds to a group (and subgroup if applicable),
containing hazard rates for dropout time. All values must be positive.
Can be NULL if no dropout is assumed. Default is NULL.}

\item{overall.time}{A numeric vector of overall study timeline when a.time is a named list with
different subgroup timings. Required for delayed subgroup scenarios. Default is NULL.}

\item{overall.intensity}{A numeric vector of overall intensity targets when a.time is a named list.
Used for delayed subgroup scenarios to maintain overall recruitment targets. Default is NULL.}

\item{seed}{A positive integer for random seed setting. Default is NULL.}
}
\value{
A data.table containing the simulated clinical trial data with the following columns:
\describe{
\item{simID}{Simulation iteration ID (1 to nsim)}
\item{group}{Group indicator (1, 2, 3, ...)}
\item{subgroup}{Subgroup indicator (A, B, C, ...) - only present if subgroups are specified}
\item{accrual.time}{Patient accrual time from study start}
\item{surv.time}{Survival time from patient entry}
\item{dropout.time}{Time to dropout from patient entry}
\item{tte}{Time-to-event (minimum of survival time and dropout time)}
\item{total}{Total time from study start (accrual time + time-to-event)}
\item{dropout}{Dropout indicator (1 = dropout occurred, 0 = event occurred)}
}
}
\description{
This function generates simulation datasets for clinical trials with multiple treatment
groups and optional subgroups using data.table for maximum performance and memory efficiency.
It extends the functionality of simData to handle complex trial designs with time-to-event
endpoints, accounting for piecewise uniform distribution for patient accrual and piecewise
exponential distributions for patient survival time and dropout time.
}
\details{
This function is the main workhorse for clinical trial simulation in the FastSurvival
package. It supports:

\describe{
\item{Multiple Treatment Groups}{
Each group can have different survival distributions and dropout rates.
}
\item{Subgroup Analysis}{
Within each treatment group, subgroups can be defined with distinct
characteristics (e.g., different biomarker status).
}
\item{Flexible Accrual Patterns}{
Common accrual patterns across all groups/subgroups, OR subgroup-specific
accrual patterns with delayed starts.
}
\item{Complex Survival Scenarios}{
Supports delayed treatment effects, time-varying hazards, and different
dropout patterns across groups. Dropout can be disabled by setting
d.time and d.hazard to NULL.
}
}

The function uses piecewise exponential and uniform distributions to provide
maximum flexibility while maintaining computational efficiency.
}
\examples{
library(data.table)

# Example 1: Standard two-group trial without subgroups
trial1 <- simTrial(
  nsim = 100,
  N = list(control = 100, treatment = 100),
  a.time = c(0, 24),
  intensity = 200/24,
  e.time = list(control = c(0, Inf), treatment = c(0, Inf)),
  e.hazard = list(control = 0.08, treatment = 0.05),
  d.time = list(control = c(0, Inf), treatment = c(0, Inf)),
  d.hazard = list(control = 0.01, treatment = 0.01)
)

# Example 2: Trial with subgroups and common accrual
trial2 <- simTrial(
  nsim = 100,
  N = list(
    control = c(A = 25, B = 112, C = 113),
    treatment = c(A = 25, B = 112, C = 113)
  ),
  a.time = c(0, 5, 10, 15, 20, 25),
  intensity = c(3.5, 14.3, 28.9, 43.6, 45),
  e.time = list(
    control = list(A = c(0, Inf), B = c(0, Inf), C = c(0, Inf)),
    treatment = list(A = c(0, Inf), B = c(0, Inf), C = c(0, Inf))
  ),
  e.hazard = list(
    control = list(A = log(2) / 5.811, B = log(2) / 5.811, C = log(2) / 5.811),
    treatment = list(A = log(2) / 4.3, B = log(2) / 4.3, C = log(2) / 4.3)
  ),
  d.time = list(
    control = list(A = c(0, Inf), B = c(0, Inf), C = c(0, Inf)),
    treatment = list(A = c(0, Inf), B = c(0, Inf), C = c(0, Inf))
  ),
  d.hazard = list(
    control = list(A = 0.01, B = 0.01, C = 0.01),
    treatment = list(A = 0.01, B = 0.01, C = 0.01)
  ),
  seed = 1
)

# Example 3: Trial without dropout
trial3 <- simTrial(
  nsim = 100,
  N = list(control = 100, treatment = 100),
  a.time = c(0, 18),
  intensity = 200/18,
  e.time = list(control = c(0, Inf), treatment = c(0, Inf)),
  e.hazard = list(control = 0.08, treatment = 0.05),
  d.time = NULL,  # No dropout
  d.hazard = NULL
)

# Example 4: Trial with delayed subgroup accrual
trial4 <- simTrial(
  nsim = 100,
  N = list(control = c(A = 50, B = 75), treatment = c(A = 50, B = 75)),
  a.time = list(A = c(6, 12, 24), B = c(0, 6, 12, 24)),  # Delayed start for A
  overall.time = c(0, 6, 12, 24),
  overall.intensity = c(10, 15, 20),
  e.time = list(
    control = list(A = c(0, Inf), B = c(0, Inf)),
    treatment = list(A = c(0, Inf), B = c(0, Inf))
  ),
  e.hazard = list(
    control = list(A = 0.08, B = 0.08),
    treatment = list(A = 0.05, B = 0.05)
  ),
  d.time = NULL,  # No dropout
  d.hazard = NULL
)

}
\references{
Luo, X., Mao, X., Chen, X., Qiu, J., Bai, S., & Quan, H. (2019).
Design and monitoring of survival trials in complex scenarios.
Statistics in Medicine, 38(2), 192-209.

Friedman, L. M., Furberg, C. D., & DeMets, D. L. (2010).
Fundamentals of Clinical Trials (4th ed.). Springer.

Proschan, M. A., Lan, K. K. G., & Wittes, J. T. (2006).
Statistical Monitoring of Clinical Trials: A Unified Approach. Springer.
}
\seealso{
\code{\link{simData}} for single-group simulation,
\code{\link{analysisData}} for creating analysis datasets,
\code{\link{lrtest}} and \code{\link{esthr}} for statistical analysis
}
